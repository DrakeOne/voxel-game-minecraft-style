<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voxel Game</title>
<link rel="stylesheet" href="style.css">
<!-- Three.js cargado de forma síncrona para garantizar disponibilidad -->
<script src="https://cdn.jsdelivr.net/npm/three@0.136.0/build/three.min.js"></script>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div id="hud">
  <div id="fps">FPS: 0</div>
  <div id="instructions">WASD/Flechas + Mouse/Táctil para moverse.</div>
</div>

<div id="mobile-controls">
  <div class="touch-button" id="btnUp">&#8679;</div>
  <div class="touch-button" id="btnLeft">&#8678;</div>
  <div class="touch-button" id="btnDown">&#8681;</div>
  <div class="touch-button" id="btnRight">&#8680;</div>
  <div class="touch-button" id="btnJump">Jump</div>
</div>

<!-- Script principal con verificación de carga -->
<script>
// Esperamos a que Three.js esté completamente cargado
if (typeof THREE === 'undefined') {
  // Si THREE no está definido, esperamos y recargamos
  console.log('Esperando a que Three.js se cargue...');
  window.addEventListener('load', function() {
    if (typeof THREE === 'undefined') {
      // Forzar recarga si aún no está disponible
      setTimeout(() => location.reload(), 1000);
    }
  });
} else {
  // Si THREE está disponible, cargamos el script principal
  const script = document.createElement('script');
  script.src = 'main.js?v=' + Date.now(); // Añadimos versión para evitar caché
  document.body.appendChild(script);
}

// Fallback: cargar main.js después de que todo esté listo
window.addEventListener('load', function() {
  setTimeout(function() {
    if (typeof THREE !== 'undefined' && !document.querySelector('script[src^="main.js"]')) {
      const script = document.createElement('script');
      script.src = 'main.js?v=' + Date.now();
      document.body.appendChild(script);
    }
  }, 100);
});
</script>
</body>
</html>